FROM python:3.12-alpine3.19

RUN apk add --no-cache git gcc musl-dev libffi-dev

RUN mkdir -p /wd/app
WORKDIR /wd/app

ARG REPOSITORY_DESTINATION__APP
ARG REPOSITORY_DESTINATION=${REPOSITORY_DESTINATION__APP}
ARG REPOSITORY_SOURCE='github.com/cqr-cryeye-forks/regexploit'
ARG REPOSITORY_COMMIT='560d229d4cfd34318488fcc83210adc2144cc189'

RUN git clone --depth 1 \
        https://@${REPOSITORY_SOURCE} \
        ${REPOSITORY_DESTINATION}

#RUN git clone --depth 1 \
#        https://${GITHUB_ACCESS_TOKEN}@${REPOSITORY_SOURCE} \
#        ${REPOSITORY_DESTINATION}
COPY . /wd/app

RUN pip install --no-cache-dir -r /wd/app/requirements.txt
RUN pip install --no-cache-dir regexploit
RUN chmod +x /usr/local/bin/regexploit

#CMD ["python3", "run_regexploit.py", "--directory", "temp_dir_for_gitzips", "--output", "data.json", "--git-ignore"]

#CMD ["python3", "run_regexploit.py", "--directory", "temp_dir_for_gitzips", "--repo_url", "https://github.com/WebGoat/WebGoat", "--output", "data.json", "--git-ignore"]
CMD ["python3", "run_regexploit.py", "--directory", "temp_dir_for_gitzips", "--repo_url", "https://github.com/digininja/DVWA", "--output", "data.json", "--git-ignore"]
#CMD ["python3", "run_regexploit.py", "--directory", "temp_dir_for_gitzips", "--repo_url", "https://github.com/OWASP/NodeGoat", "--output", "data.json", "--git-ignore"]
